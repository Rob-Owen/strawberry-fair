# Strawberry Fair Website

## Overview

This is source code for the Cambridge Strawberry Fair website. 

This frontend is a static site generated by [Gatsby](https://www.gatsbyjs.org/). Content is managed via [NetlifyCMS](https://www.netlifycms.org/).

## Local Development Setup

Prerequisites:
* Node v12.13 or higher
* npm 6.13.0 or higher
* gatsby cli (`npm install -g gatsby-cli`)

Checkout the source code and run the following from this directory:
1. `npm ci`
2. `npm start`

Gatsby will build and run the site in develop mode. When complete, the site will be accessing at `localhost:8000`.

## CMS Local Running

If you are running locally and you need to access the CMS, go into `static/admin/config.yml` and change

```
backend:
  name: git-gateway
  accept_roles:
    - admin
    - content
```

to

```
backend:
  name: github
  repo: Softwire/strawberry-fair
  branch: [ YOUR BRANCH HERE ]
```

ensuring you include the name of the branch you're working on.

**_Make sure you change it back before merging anything back into master._**


## CMS Editorial Workflow

When editing the website via CMS, new changes can be marked as "draft", "in review" or "ready" for deployment using the "Set status" button.

These changes can then be reviewed by all CMS users via the "Workflow" tab.

Changes will only go live when they are "published".

Behind the scenes, Netlify editorial actions automatically perform git actions as follows:

| Netlify        | Git                                                    |
|----------------|--------------------------------------------------------|
| Save draft     | Commits to a new branch and opens a pull request       |
| Edit draft     | Pushes another commit to the draft branch/pull request |
| Publish draft  | Merges pull request and deletes branch                 |

## Testing

To run unit tests, use: `npm run test:unit`.
To run end-to-end tests, use: `npm run test:e2e`.
To run all tests, use `npm run test`.